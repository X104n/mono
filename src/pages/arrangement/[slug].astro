---
import { marked } from "marked";
import { getEventBySlug } from "../../lib/data/sanity/events";
import EventSidebar from "../../components/EventSidebar.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect("/404");
}

const event = await getEventBySlug(slug);

if (!event) {
  return Astro.redirect("/404");
}

const content = marked.parse(event.body);
---

<BaseLayout title={event.title}>
  <main class="flex flex-col gap-24 md:flex-row md:gap-8">
    <div class="h-fit w-full rounded-xl border-2 bg-background p-6 shadow-xl">
      <article class="prose" set:html={content} />
    </div>

    <EventSidebar event={event} />
  </main>
</BaseLayout>
